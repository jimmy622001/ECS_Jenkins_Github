# IMPORTANT: This file is for POC/local development/testing only
# It provides dummy values to allow terraform plan to run without AWS Secrets Manager
# DO NOT commit sensitive information in this file
# This file takes precedence over secrets.tf because Terraform loads files alphabetically

# This file uses the use_aws_secrets variable from secrets.tf

# Dummy values for development/POC purposes
locals {
  # Database credentials
  dummy_db_creds = {
    username = "db_admin"
    password = "dummy_password_change_me"
    dbname   = "application_db"
  }
  
  # Grafana credentials
  dummy_grafana_creds = {
    admin_user = "admin"
    admin_password = "dummy_password_change_me"
  }
  
  # SSH key information
  dummy_ssh_key_info = {
    key_name = "dummy-ssh-key"
    public_key = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC... dummy@example.com"
    private_key = "-----BEGIN OPENSSH PRIVATE KEY-----\ndummy_key_content_change_me\n-----END OPENSSH PRIVATE KEY-----"
  }
  
  # Network security settings
  dummy_network_security = {
    trusted_ips = ["10.0.0.0/16", "192.168.1.0/24"]
    vpn_cidrs = ["10.0.0.0/16"]
    office_ip_ranges = ["203.0.113.0/24"]
  }
  
  # Security settings
  dummy_security_settings = {
    waf_ip_block_list = ["198.51.100.0/24"]
    notification_email = "security@example.com"
    waf_rate_limit = 1000
    max_request_size = 10485760
    enable_security_hub = false
    enable_guardduty = true
  }
  
  # AWS account configurations
  dummy_aws_config = {
    aws_account_id = "123456789012"
    cross_account_role = "arn:aws:iam::123456789012:role/cross-account-role"
    backup_retention_period = "7"
    cross_region_backup_bucket = "dummy-backup-bucket"
  }
  
  # Domain and certificate configurations
  dummy_domain_config = {
    domain_name = "dev.example.com"
    enable_https = true
    certificate_arn = "arn:aws:acm:us-east-1:123456789012:certificate/dummy-cert-id"
  }

  # API keys (optional)
  dummy_api_keys = {
    github_token = "dummy_github_token"
    docker_registry_token = "dummy_docker_registry_token"
  }
  
  # Use local values if AWS Secrets Manager is disabled or if the secrets don't exist
  db_creds = var.use_aws_secrets && length(try(data.aws_secretsmanager_secret_version.db_credentials, [])) > 0 ? 
    try(jsondecode(data.aws_secretsmanager_secret_version.db_credentials[0].secret_string), local.dummy_db_creds) : 
    local.dummy_db_creds
  grafana_creds = var.use_aws_secrets && length(try(data.aws_secretsmanager_secret_version.grafana_credentials, [])) > 0 ? 
    try(jsondecode(data.aws_secretsmanager_secret_version.grafana_credentials[0].secret_string), local.dummy_grafana_creds) : 
    local.dummy_grafana_creds
  
  ssh_key_info = var.use_aws_secrets && length(try(data.aws_secretsmanager_secret_version.ssh_key, [])) > 0 ? 
    try(jsondecode(data.aws_secretsmanager_secret_version.ssh_key[0].secret_string), local.dummy_ssh_key_info) : 
    local.dummy_ssh_key_info
  
  network_security = var.use_aws_secrets && length(try(data.aws_secretsmanager_secret_version.network_security, [])) > 0 ? 
    try(jsondecode(data.aws_secretsmanager_secret_version.network_security[0].secret_string), local.dummy_network_security) : 
    local.dummy_network_security
  
  security_settings = var.use_aws_secrets && length(try(data.aws_secretsmanager_secret_version.security_settings, [])) > 0 ? 
    try(jsondecode(data.aws_secretsmanager_secret_version.security_settings[0].secret_string), local.dummy_security_settings) : 
    local.dummy_security_settings
  
  aws_config = var.use_aws_secrets && length(try(data.aws_secretsmanager_secret_version.aws_config, [])) > 0 ? 
    try(jsondecode(data.aws_secretsmanager_secret_version.aws_config[0].secret_string), local.dummy_aws_config) : 
    local.dummy_aws_config
  
  domain_config = var.use_aws_secrets && length(try(data.aws_secretsmanager_secret_version.domain_config, [])) > 0 ? 
    try(jsondecode(data.aws_secretsmanager_secret_version.domain_config[0].secret_string), local.dummy_domain_config) : 
    local.dummy_domain_config
  
  api_keys = var.use_aws_secrets && length(try(data.aws_secretsmanager_secret_version.api_keys, [])) > 0 ? 
    try(jsondecode(data.aws_secretsmanager_secret_version.api_keys[0].secret_string), local.dummy_api_keys) : 
    local.dummy_api_keys

  # Extract specific values for use in the infrastructure
  db_username = local.db_creds.username
  db_password = local.db_creds.password
  db_name = lookup(local.db_creds, "dbname", "application_db")
  grafana_admin_user = lookup(local.grafana_creds, "admin_user", "admin")
  grafana_admin_password = local.grafana_creds.admin_password
  key_name = local.ssh_key_info.key_name
  private_key = lookup(local.ssh_key_info, "private_key", "")
  trusted_ips = lookup(local.network_security, "trusted_ips", ["10.0.0.0/16"])
  vpn_cidrs = lookup(local.network_security, "vpn_cidrs", ["10.0.0.0/16"])
  office_ip_ranges = lookup(local.network_security, "office_ip_ranges", ["203.0.113.0/24"])
  waf_ip_block_list = lookup(local.security_settings, "waf_ip_block_list", ["198.51.100.0/24"])
  security_notification_email = lookup(local.security_settings, "notification_email", "security@example.com")
  waf_rate_limit = lookup(local.security_settings, "waf_rate_limit", 1000)
  max_request_size = lookup(local.security_settings, "max_request_size", 10485760)
  enable_security_hub = lookup(local.security_settings, "enable_security_hub", false)
  enable_guardduty = lookup(local.security_settings, "enable_guardduty", true)
  aws_account_id = lookup(local.aws_config, "aws_account_id", "123456789012")
  cross_account_role = lookup(local.aws_config, "cross_account_role", "")
  backup_retention_period = lookup(local.aws_config, "backup_retention_period", "7")
  cross_region_backup_bucket = lookup(local.aws_config, "cross_region_backup_bucket", "dummy-backup-bucket")
  domain_name = lookup(local.domain_config, "domain_name", "dev.example.com")
  enable_https = lookup(local.domain_config, "enable_https", true)
  certificate_arn = lookup(local.domain_config, "certificate_arn", "")
  
  # This local variable map can be used across your Terraform configurations
  sensitive_variables = {
    db_username = local.db_username
    db_password = local.db_password
    db_name = local.db_name
    grafana_admin_user = local.grafana_admin_user
    grafana_admin_password = local.grafana_admin_password
    key_name = local.key_name
    private_key = local.private_key
    trusted_ips = local.trusted_ips
    vpn_cidrs = local.vpn_cidrs
    office_ip_ranges = local.office_ip_ranges
    waf_ip_block_list = local.waf_ip_block_list
    security_notification_email = local.security_notification_email
    waf_rate_limit = local.waf_rate_limit
    max_request_size = local.max_request_size
    enable_security_hub = local.enable_security_hub
    enable_guardduty = local.enable_guardduty
    aws_account_id = local.aws_account_id
    cross_account_role = local.cross_account_role
    backup_retention_period = local.backup_retention_period
    cross_region_backup_bucket = local.cross_region_backup_bucket
    domain_name = local.domain_name
    enable_https = local.enable_https
    certificate_arn = local.certificate_arn
  }
}

# Output to confirm that dummy values are being used
output "secrets_source" {
  value = var.use_aws_secrets ? "Using AWS Secrets Manager" : "Using dummy values for POC/development"
}